---
title: "Google Data Analytics Case Study #1"
output: html_notebook
---
Author: JianHui (Jake) Li

Date: 07/24/2022

## Introduction

This is a capstone project from the final course of the Google Data Analytics Professional Certificate (track #1, case study #1). For more information click [here](https://www.coursera.org/learn/google-data-analytics-capstone?). I will be following the steps of the data analysis process (ask, prepare, process, analyze, share, act) I learned throughout the courses, and the case study roadmap provided as a guide.

## Background

**About the company:**
In 2016, Cyclistic launched a successful bike-share offering. Since then, the program has grown to a fleet of 5,824 bicycles that are geotracked and locked into a network of 692 stations across Chicago. The bikes can be unlocked from one station and returned to any other station in the system anytime.

**Scenario:**
You are a junior data analyst working in the marketing analyst team at Cyclistic, a bike-share company in Chicago. The director of marketing believes the company’s future success depends on maximizing the number of annual memberships. Therefore, your team wants to understand how casual riders and annual members use Cyclistic bikes differently. From these insights, your team will design a new marketing strategy to convert casual riders into annual members. But first, Cyclistic executives must approve your recommendations, so they must be backed up with compelling data insights and professional data visualizations.

**Business task:**
Identify trends and differences between members and casual riders using Cyclistic historical bike trip data to help design marketing strategies for the Cyclistic marketing analytics team.

**Data Source:**
[Cyclistic’s Historical Trip Data (06/2021 - 05/2022)](https://divvy-tripdata.s3.amazonaws.com/index.html)

*Note*: These datasets have a different name because Cyclistic is a fictional company, and the data has been made available by Motivate International Inc. under this [license](https://www.divvybikes.com/data-license-agreement).

***

```{r message=FALSE, warning=FALSE}
# Setting up the environment.
library(tidyverse)
library(skimr)
library(ggplot2)
library(lubridate)
library(scales)
library(RColorBrewer)
```

```{r message=FALSE}
# Merging all CSV files into one.
bike_trip_df <- list.files(path = "C:/Users/lijhu/Documents/Workspace/Google_Case_Study_1/Original_Raw_Data", full.names = TRUE) %>%
  lapply(read_csv) %>%
  bind_rows
```

```{r}
# Display the column names of the dataframe.
colnames(bike_trip_df)
```

```{r}
# Display the first 6 rows of the dataframe.
head(bike_trip_df)
```

```{r}
# Produce a summary of the dataframe.
summary(bike_trip_df)
```

```{r}
# Sort the started_at (Date and time when ride started) column by descending order so the most recent dates appear first.
bike_trip_df_cleaned_v0 <- arrange(bike_trip_df, desc(started_at))

# Remove latitudes and longitudes because I won't be using geographic data.
bike_trip_df_cleaned_v1 <- select(bike_trip_df_cleaned_v0, -c(start_lat, start_lng, end_lat, end_lng))

# Rename columns.
bike_trip_df_cleaned_v2 <- rename(bike_trip_df_cleaned_v1, from_station = start_station_name, from_station_id = start_station_id, to_station = end_station_name, to_station_id = end_station_id, casual_or_member = member_casual)
```

```{r}
head(bike_trip_df_cleaned_v2)
```

```{r}
# Add ride_length, day_of_week, month, season, and time_of_day columns to provide more ways to aggregate data.
bike_trip_df_cleaned_v3 <- bike_trip_df_cleaned_v2 %>%
  mutate(ride_length = round(difftime(ended_at, started_at, units = "mins"), 2))

bike_trip_df_cleaned_v3$day_of_week <- weekdays(as.Date(bike_trip_df_cleaned_v3$started_at))
#bike_trip_df_cleaned_v3$date <- as.Date(bike_trip_df_cleaned_v4$started_at)
#bike_trip_df_cleaned_v3$year <- format(as.Date(bike_trip_df_cleaned_v4$date), "%Y")
#bike_trip_df_cleaned_v3$month <- format(as.Date(bike_trip_df_cleaned_v3$started_at), "%m")

seasons <- c(
  "01" = "Winter", "02" = "Winter",
  "03" = "Spring", "04" = "Spring", "05" = "Spring",
  "06" = "Summer", "07" = "Summer", "08" = "Summer",
  "09" = "Fall", "10" = "Fall", "11" = "Fall",
  "12" = "Winter")
bike_trip_df_cleaned_v3$season <- seasons[format(as.Date(bike_trip_df_cleaned_v3$started_at), "%m")]

breaks <- hour(hm("00:00", "5:00", "11:00", "17:00", "20:00", "23:59"))
labels <- c("Night", "Morning", "Afternoon", "Evening", "Late_Evening")
bike_trip_df_cleaned_v3$time_of_day <- cut(x=hour(bike_trip_df_cleaned_v3$started_at), breaks = breaks, labels = labels, include.lowest=TRUE)
# 00:00 - 06:00 is night
# 06:00 - 12:00 is morning
# 12:00 - 18:00 is afternoon
# 18:00 - 21:00 is evening
# 21:00 - 23:59 is late evening
```

```{r}
colnames(bike_trip_df_cleaned_v3)
```

```{r}
head(bike_trip_df_cleaned_v3)
```

```{r}
# Structure of the dataframe.
str(bike_trip_df_cleaned_v3)
```

```{r}
# Change the data type of rideable_type, casual_or_member, day_of_week, and season columns to factor because they are categorical data.
bike_trip_df_cleaned_v3$rideable_type <- as.factor(bike_trip_df_cleaned_v3$rideable_type)
bike_trip_df_cleaned_v3$casual_or_member <- as.factor(bike_trip_df_cleaned_v3$casual_or_member)
bike_trip_df_cleaned_v3$day_of_week <- as.factor(bike_trip_df_cleaned_v3$day_of_week)
bike_trip_df_cleaned_v3$season <- as.factor(bike_trip_df_cleaned_v3$season)

# Order the categorical levels of day_of_week, season and time_of_day columns.
bike_trip_df_cleaned_v3$day_of_week <- ordered(bike_trip_df_cleaned_v3$day_of_week, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
bike_trip_df_cleaned_v3$season <- ordered(bike_trip_df_cleaned_v3$season, levels=c("Spring", "Summer", "Fall", "Winter"))
bike_trip_df_cleaned_v3$time_of_day <- ordered(bike_trip_df_cleaned_v3$time_of_day, levels=c("Morning", "Afternoon", "Evening", "Late_Evening", "Night"))

# Change the data type of the ride_length column to numeric and rename it.
bike_trip_df_cleaned_v3$ride_length <- as.numeric(bike_trip_df_cleaned_v3$ride_length)
bike_trip_df_cleaned_v3 <- rename(bike_trip_df_cleaned_v3, ride_length_in_mins = ride_length)
```

```{r}
str(bike_trip_df_cleaned_v3)
```

```{r}
summary(bike_trip_df_cleaned_v3)
```

```{r}
# I noticed the minimum of ride length is negative which could be caused when start_time > end_time. Therefore, I am going to remove rows where the started_at date is greater than the ended_at date.
bike_trip_df_cleaned_v4 <- filter(bike_trip_df_cleaned_v3, !started_at > ended_at)

# Also remove rows where ride_length is equal to 0 minutes.
bike_trip_df_cleaned_v4 <- filter(bike_trip_df_cleaned_v4, ride_length_in_mins != 0)
```

```{r}
summary(bike_trip_df_cleaned_v4)
```

```{r}
# Disable warming from summarize/summaries since it doesn't affect our result.
options(dplyr.summarise.inform = FALSE)
```


```{r}
# Summary of the ride_length_in_mins column.
summary(bike_trip_df_cleaned_v4$ride_length_in_mins)
```

```{r}
# From the previous results, we can see the maximum ride length is 55944.15 minutes (about 932 hours) which is unrealistic. Therefore, I decided to use the interquartile range method to define outliers and remove them. Any value above the upper fence will be considered outliers.
# Upper fence: Q3 + (1.5 * IQR)
# IQR = Q3 - Q1
20.60 + (1.5 * (20.60 - 6.37)) # Upper limit for ride length
```

```{r}
# Also, the minimum ride length is 0.02 minutes or 1.2 seconds which is unrealistic as well. The interquartile range method doesn't work for the lower fence because I will get a negative number. Hence, I will take the simple approach. Any value less than 0.025 percentile (bottom 2.5%) will be considered as outliers.
quantile(bike_trip_df_cleaned_v4$ride_length_in_mins, 0.025)
```


```{r}
# Based on value from previous steps and some research on the company's bike usage time limit, It's safe to assume that ride length more than 45 minutes or less than 1.68 minutes are outliers and will be removed and saved to another dataframe.
ride_length_outliers <- filter(bike_trip_df_cleaned_v4, ride_length_in_mins > 45 | ride_length_in_mins < 1.68)
bike_trip_df_final <- filter(bike_trip_df_cleaned_v4, ride_length_in_mins <= 45 & ride_length_in_mins >= 1.68)
```

```{r}
# Number of rides, average, minimum, median, and maximum of ride length in minutes by customer type.
bike_trip_df_final %>%
  group_by(casual_or_member) %>%
  summarize(number_of_rides = n(),
            average_ride_length = mean(ride_length_in_mins),
            minimum_ride_length = min(ride_length_in_mins),
            median_ride_length = median(ride_length_in_mins),
            maximum_ride_length = max(ride_length_in_mins))
```

```{r}
# Number of rides, average, minimum, median, and maximum of ride length in minutes by customer type per season.
bike_trip_df_final %>%
  group_by(season, casual_or_member) %>%
  summarize(number_of_rides = n(),
            average_ride_length = mean(ride_length_in_mins))
```

```{r}
# Number of rides and average ride length in minutes by customer type per month.
bike_trip_df_final %>%
  group_by(month = lubridate::floor_date(started_at, 'month'), casual_or_member) %>% 
  summarize(count = n(),
            average_ride_length = mean(ride_length_in_mins))
```

```{r}
# Number of rides and average ride length in minutes by customer type per day of week and time of day.
bike_trip_df_final %>%
  group_by(casual_or_member, day_of_week, time_of_day) %>%
  summarize(number_of_rides = n(),
            average_ride_length = mean(ride_length_in_mins))
```

```{r}
# Number of rides and average ride length in minutes by customer type per time of day.
bike_trip_df_final %>%
  group_by(time_of_day, casual_or_member) %>%
  summarize(number_of_rides = n(),
            average_ride_length = mean(ride_length_in_mins))
```


```{r}
# Rideable type frequency and its average ride length in minutes by customer type.
bike_trip_df_final %>%
  group_by(casual_or_member, rideable_type) %>%
  summarize(count = n(),
            average_ride_length = mean(ride_length_in_mins))
```

```{r fig.height=6, fig.width=8}
# Display color palettes that are color blind friendly.
display.brewer.all(colorblindFriendly = TRUE)
```

```{r fig.height=4, fig.width=6}
ride_count <- ggplot(bike_trip_df_final, aes(x = casual_or_member, fill = casual_or_member)) +
  geom_bar() +
  labs(title = "Number of rides by customer type", y = "Number of rides") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6)) +
  geom_text(aes(label = ..count..), stat = "count", vjust = 2, colour = "white") +
  scale_fill_brewer(palette = "Set2", direction = -1) +
  theme_classic() +
  theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(), legend.title = element_blank())

ride_count
```

```{r fig.height=4, fig.width=6}
avg_ride_length <- bike_trip_df_final %>%
  group_by(casual_or_member) %>%
  summarize(average_ride_length = mean(ride_length_in_mins)) %>% 
  ggplot(aes(x = casual_or_member, y = average_ride_length, fill = casual_or_member)) +
  labs(title = "Average ride length in minutes by customer type", y = "Average ride length") +
  geom_bar(stat = "summary", fun = "mean") +
  geom_text(aes(label = round(average_ride_length, 2)), nudge_y = -1, colour = "white") +
  scale_fill_brewer(palette = "Set2", direction = -1) +
  theme_classic() + theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(), legend.title = element_blank())

avg_ride_length
```

```{r fig.height=7, fig.width=8}
ride_count_per_season <- ggplot(bike_trip_df_final, aes(x = casual_or_member, fill = casual_or_member)) +
  geom_bar() +
  labs(title = "Number of rides by customer type per season", y = "Number of rides") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6)) +
  scale_fill_brewer(palette = "Set2", direction = -1) +
  facet_wrap(~season) +
  theme_classic() +
  theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(), legend.title = element_blank())

ride_count_per_season
```

```{r fig.height=7, fig.width=10}
ride_count_by_day_of_week <- ggplot(bike_trip_df_final, aes(x = casual_or_member, fill = casual_or_member)) +
  geom_bar() +
  labs(title = "Number of rides by customer type per day of week", y = "Number of rides") +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6)) +
  scale_fill_brewer(palette = "Set2", direction = -1) +
  facet_wrap(~day_of_week) +
  theme_classic() +
  theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(), legend.title = element_blank())

ride_count_by_day_of_week
```

```{r fig.height=7, fig.width=10}
ride_count_per_day_and_time <- ggplot(bike_trip_df_final, aes(x = casual_or_member, fill = time_of_day)) +
  geom_bar(position = "dodge") +
  labs(title = "Number of rides by customer type per day and time", y = "Number of rides") +
  guides(fill = guide_legend(title = "time of day")) +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6)) +
  scale_fill_brewer(palette = "YlGnBu") +
  facet_wrap(~day_of_week) +
  theme(axis.title.x = element_blank())

ride_count_per_day_and_time
# Reminder:
# 00:00 - 06:00 is night
# 06:00 - 12:00 is morning
# 12:00 - 18:00 is afternoon
# 18:00 - 21:00 is evening
# 21:00 - 23:59 is late evening
```

```{r fig.height=4, fig.width=7}
rideable_type_count <- ggplot(bike_trip_df_final, aes(x = casual_or_member, fill = rideable_type)) +
  geom_bar(position = "dodge") +
  labs(title = "Number of rides by customer type per rideable type", y = "Number of rides") +
  guides(fill = guide_legend(title = "rideable type")) +
  scale_fill_brewer(palette = "Dark2") +
  theme_classic() +
  theme(axis.title.x = element_blank())

rideable_type_count
```
